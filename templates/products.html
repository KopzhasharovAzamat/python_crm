<!--templates/products.html-->
{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4 animate__animated animate__fadeIn">Товары</h2>
<a href="{% url 'product_add' %}" class="btn btn-success mb-4"><i class="fas fa-plus"></i> Добавить товар</a>
<form method="get" class="mb-4">
    <div class="row g-3">
        <div class="col-md-4">
            <input type="text" name="q" placeholder="Поиск..." value="{{ request.GET.q }}" class="form-control">
        </div>
        <div class="col-md-3">
            <select name="category" class="form-control">
                <option value="">Все категории</option>
                {% for cat in categories %}
                <option value="{{ cat.name }}" {% if request.GET.category == cat.name %}selected{% endif %}>{{ cat.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <input type="number" name="min_quantity" placeholder="Мин. остаток" value="{{ request.GET.min_quantity }}" class="form-control">
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100"><i class="fas fa-filter"></i> Фильтр</button>
        </div>
    </div>
</form>
{% if low_stock_message %}
<div class="alert alert-warning alert-dismissible fade show animate__animated animate__fadeIn" role="alert">
    {{ low_stock_message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endif %}
<div class="row row-cols-1 row-cols-md-3 g-4">
    {% for product in products %}
    <div class="col">
        <div class="card h-100 {% if product.quantity < 5 %}border-danger{% endif %} animate__animated animate__fadeInUp">
            {% if product.photo %}
            <img src="{{ product.photo.url }}" class="card-img-top" alt="{{ product.name }}" style="max-width: 100%;">
            {% else %}
            <div class="card-img-top bg-secondary d-flex align-items-center justify-content-center" style="height: 200px;">
                <i class="fas fa-image fa-3x text-white"></i>
            </div>
            {% endif %}
            <div class="card-body">
                <h5 class="card-title">{{ product.name }}</h5>
                <p class="card-text">
                    <strong>Категория:</strong> {{ product.category|default:"Не указана" }}<br>
                    <strong>Подкатегория:</strong> {{ product.subcategory|default:"Не указана" }}<br>
                    <strong>Количество:</strong> {{ product.quantity }}<br>
                    <strong>Цена:</strong> {{ product.selling_price }} ₽
                </p>
            </div>
            <div class="card-footer text-center">
                <a href="{% url 'sale_create' product.id %}" class="btn btn-primary btn-sm"><i class="fas fa-shopping-cart"></i> Продать</a>
                <a href="{% url 'product_edit' product.id %}" class="btn btn-warning btn-sm"><i class="fas fa-edit"></i> Редактировать</a>
                <button class="btn btn-danger btn-sm delete-btn" data-action="{% url 'product_delete' product.id %}" data-message="Вы уверены, что хотите удалить товар {{ product.name }}?"><i class="fas fa-trash"></i> Удалить</button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}