<!--templates/products.html-->
{% extends 'base.html' %}
{% block content %}
<h2>Товары</h2>
<a href="{% url 'product_add' %}" class="btn btn-success mb-3">Добавить товар</a>
<form method="get" class="mb-3">
    <input type="text" name="q" placeholder="Поиск..." value="{{ request.GET.q }}">
    <select name="category">
        <option value="">Все категории</option>
        {% for cat in categories %}
        <option value="{{ cat.name }}" {% if request.GET.category == cat.name %}selected{% endif %}>{{ cat.name }}</option>
        {% endfor %}
    </select>
    <input type="number" name="min_quantity" placeholder="Мин. остаток" value="{{ request.GET.min_quantity }}">
    <button type="submit" class="btn btn-primary">Фильтр</button>
</form>
{% if low_stock_message %}
<div class="alert alert-warning">{{ low_stock_message }}</div>
{% endif %}
<table class="table">
    <thead>
    <tr>
        <th>Название</th>
        <th>Категория</th>
        <th>Подкатегория</th>
        <th>Количество</th>
        <th>Цена</th>
        <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    {% for product in products %}
<tr {% if product.quantity < 5 %}class="table-danger"{% endif %}>
    <td>{{ product.name }}</td>
    <td>{{ product.category }}</td>
    <td>{{ product.subcategory }}</td>
    <td>{{ product.quantity }}</td>
    <td>{{ product.selling_price }}</td>
    <td>
        <a href="{% url 'sale_create' product.id %}" class="btn btn-sm btn-primary">Продать</a>
        <a href="{% url 'product_edit' product.id %}" class="btn btn-sm btn-warning">Редактировать</a>
        <a href="{% url 'product_delete' product.id %}" class="btn btn-sm btn-danger">Удалить</a>
    </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}