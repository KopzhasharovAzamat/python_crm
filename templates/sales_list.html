<!--templates/sales_list.html-->
{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4 animate__animated animate__fadeIn">Список продаж</h2>

<!-- Форма фильтров -->
<form method="get" class="mb-4">
    <div class="row g-3">
        <div class="col-md-2">
            <input type="text" name="product_name" placeholder="Название товара" value="{{ product_name }}" class="form-control">
        </div>
        <div class="col-md-2">
            <select name="warehouse" class="form-control">
                <option value="">Все склады</option>
                {% for wh in warehouses %}
                <option value="{{ wh.name }}" {% if warehouse == wh.name %}selected{% endif %}>{{ wh.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="date_from" value="{{ date_from }}" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="date" name="date_to" value="{{ date_to }}" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="number" name="min_amount" placeholder="Мин. сумма" value="{{ min_amount }}" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="number" name="max_amount" placeholder="Макс. сумма" value="{{ max_amount }}" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="number" name="min_quantity" placeholder="Мин. кол-во" value="{{ min_quantity }}" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="number" name="max_quantity" placeholder="Макс. кол-во" value="{{ max_quantity }}" class="form-control">
        </div>
        <div class="col-md-2">
            <select name="sort_by" class="form-control">
                <option value="">Сортировать...</option>
                <option value="date" {% if sort_by == 'date' %}selected{% endif %}>По дате (возр.)</option>
                <option value="-date" {% if sort_by == '-date' %}selected{% endif %}>По дате (убыв.)</option>
                <option value="items__product__name" {% if sort_by == 'items__product__name' %}selected{% endif %}>По названию товара (А-Я)</option>
                <option value="-items__product__name" {% if sort_by == '-items__product__name' %}selected{% endif %}>По названию товара (Я-А)</option>
                <option value="items__quantity" {% if sort_by == 'items__quantity' %}selected{% endif %}>По количеству (возр.)</option>
                <option value="-items__quantity" {% if sort_by == '-items__quantity' %}selected{% endif %}>По количеству (убыв.)</option>
                <option value="items__product__warehouse__name" {% if sort_by == 'items__product__warehouse__name' %}selected{% endif %}>По складу (А-Я)</option>
                <option value="-items__product__warehouse__name" {% if sort_by == '-items__product__warehouse__name' %}selected{% endif %}>По складу (Я-А)</option>
                <option value="items__actual_price_total" {% if sort_by == 'items__actual_price_total' %}selected{% endif %}>По сумме (возр.)</option>
                <option value="-items__actual_price_total" {% if sort_by == '-items__actual_price_total' %}selected{% endif %}>По сумме (убыв.)</option>
            </select>
        </div>
        <div class="col-md-2 d-flex gap-2">
            <button type="submit" class="btn btn-primary flex-fill"><i class="fas fa-filter"></i> Фильтр</button>
            <a href="{% url 'sales_list' %}" class="btn btn-secondary flex-fill"><i class="fas fa-times"></i> Очистить</a>
        </div>
    </div>
</form>

<div class="row">
    {% for sale in sales %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 animate__animated animate__fadeInUp">
            <div class="card-body">
                <h5 class="card-title">Продажа №{{ sale.id }}</h5>
                <p class="card-text">
                    <strong>Дата:</strong> {{ sale.date }}<br>
                    <strong>Товары:</strong><br>
                    {% for item in sale.items.all %}
                    {{ item.product.name }} - {{ item.quantity }} шт.<br>
                    {% endfor %}
                    <strong>Итого:</strong> {{ sale.calculate_totals.1|floatformat:2 }} ₽
                </p>
                <a href="{% url 'sale_detail' sale.id %}" class="btn btn-primary btn-sm">Подробнее</a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}